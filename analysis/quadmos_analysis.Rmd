---
title: "Quadrilateral Models"
author: "Andres Gomez Emilsson"
date: "May 8, 2015"
output: html_document
---


```{r prelims}
library(dplyr)
library(tidyr)
library(ggplot2)
library(binom)
library(lme4)
```


```{r data_clean}
d <- read.csv("experiment_1.tsv", header=TRUE, sep="\t", row.names=NULL, stringsAsFactors = FALSE)
d1 <- read.csv("experiment_2.tsv", header=TRUE, sep="\t", row.names=NULL, stringsAsFactors = FALSE)

d <- rbind(d, d1)

n_participants <- length(d$Answer.training_regime)

pre_and_post_responses <- NULL

for (i in 1:length(d$Answer.training_regime)){
  pre_responses <- d$Answer.pretest_responses[i]
  pre_responses <- substr(pre_responses, 2, 24)
  pre_values <- as.integer(strsplit(pre_responses, ",")[[1]])
  
  post_responses <- d$Answer.posttest_responses[i]
  post_responses <- substr(post_responses, 2, 24)
  post_values <- as.integer(strsplit(post_responses, ",")[[1]])
  
  values <- c(pre_values, post_values)
  
  pre_and_post_responses <- rbind(pre_and_post_responses, values)
}

relevant_df <- data.frame(pre_and_post_responses)
colnames(relevant_df) <- c("pre_1", "pre_2", "pre_3", "pre_4", "pre_5", "pre_6", "pre_7", "pre_8", "pre_9", "pre_10", "pre_11", "pre_12", "post_1", "post_2", "post_3", "post_4", "post_5", "post_6", "post_7", "post_8", "post_9", "post_10", "post_11", "post_12")


# Condition 
relevant_df$condition <- d$Answer.training_regime
relevant_df$time <- d$Answer.training_time
relevant_df$shape <- d$Answer.shape_of_focus


```

Question order:

1) Are all squares parallelograms?
2) Are all squares rectangles?
3) Are all squares also rhombuses?
4) Are all rectangles also parallelograms?
5) Are all rectangles also rhombuses?
6) Are all rectangles also squares?
7) Are all rhombuses also parallelograms?
8) Are all rhombuses also rectangles?
9) Are all rhombuses also squares?
10) Are all parallelograms also rectangles?
11) Are all parallelograms also rhombuses?
12) Are all parallelograms also squares?

# shape numbers: 0 square, 1 rectangle, 2 rhombus, 3 parallelogram
# conditions: 3 Active learning, 4 Passive learning, 5 Baseline condition


```{r answer_means}
# real correct
correct_responses <- c(0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1)

#correct_responses <- c(0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1)

# consistent with alternative
#correct_responses <- c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)


square_related <- c(1, 2, 3, 6, 9, 12)
rectangle_related <- c(2, 4, 5, 6, 8, 10)
rhombus_related <- c(3, 5, 7, 8, 9, 11)
parallelogram_related <- c(1, 4, 7, 10, 11, 12)


relevant_df$pre_correct <- 1:n_participants*0
relevant_df$post_correct <- 1:n_participants*0

relevant_df$pre_square_related <- 1:n_participants*0
relevant_df$post_square_related <- 1:n_participants*0

relevant_df$pre_rectangle_related <- 1:n_participants*0
relevant_df$post_rectangle_related <- 1:n_participants*0

relevant_df$pre_rhombus_related <- 1:n_participants*0
relevant_df$post_rhombus_related <- 1:n_participants*0

relevant_df$pre_parallelogram_related <- 1:n_participants*0
relevant_df$post_parallelogram_related <- 1:n_participants*0


for (i in 1:length(relevant_df$condition)) {
  relevant_df$pre_correct[i] <- sum(correct_responses == relevant_df[i,1:12])
  relevant_df$post_correct[i] <- sum(correct_responses == relevant_df[i,13:24])
  
  relevant_df$pre_square_related[i] <- sum(correct_responses[square_related] == relevant_df[i,square_related])
  relevant_df$post_square_related[i] <- sum(correct_responses[square_related] == relevant_df[i,(square_related + 12)])
  relevant_df$pre_rectangle_related[i] <- sum(correct_responses[rectangle_related] == relevant_df[i,rectangle_related])
  relevant_df$post_rectangle_related[i] <- sum(correct_responses[rectangle_related] == relevant_df[i,(rectangle_related + 12)])
  relevant_df$pre_rhombus_related[i] <- sum(correct_responses[rhombus_related] == relevant_df[i,rhombus_related])
  relevant_df$post_rhombus_related[i] <- sum(correct_responses[rhombus_related] == relevant_df[i,(rhombus_related + 12)])
  relevant_df$pre_parallelogram_related[i] <- sum(correct_responses[parallelogram_related] == relevant_df[i,parallelogram_related])
  relevant_df$post_parallelogram_related[i] <- sum(correct_responses[parallelogram_related] == relevant_df[i,(parallelogram_related + 12)])
}

relevant_df$reasonable_time <- relevant_df$time > 20000

relevant_df$correct_delta <- relevant_df$post_correct - relevant_df$pre_correct
relevant_df$square_delta <- relevant_df$post_square_related - relevant_df$pre_square_related
relevant_df$rectangle_delta <- relevant_df$post_rectangle_related - relevant_df$pre_rectangle_related
relevant_df$rhombus_delta <- relevant_df$post_rhombus_related - relevant_df$pre_rhombus_related
relevant_df$parallelogram_delta <- relevant_df$post_parallelogram_related - relevant_df$pre_parallelogram_related



means_by_condition <- aggregate(cbind(pre_square_related, post_square_related, pre_rectangle_related, post_rectangle_related,  pre_rhombus_related, post_rhombus_related, pre_parallelogram_related, post_parallelogram_related, pre_correct, post_correct, correct_delta, time) ~ 
                             condition + shape, data=relevant_df, mean)

means_by_condition


deltas_by_condition <- aggregate(cbind(correct_delta, square_delta, rectangle_delta, rhombus_delta, parallelogram_delta, time) ~ 
                             condition + shape, data=relevant_df, mean)
deltas_by_condition

relevant_df$same <- 1:220*0

means_of_questions <- aggregate(cbind(pre_1, pre_2, pre_3, pre_4, pre_5, pre_6, pre_7, pre_8, pre_9, pre_10, pre_11, pre_12, pre_correct) ~ 
                             reasonable_time, data=relevant_df, mean)

sum(means_of_questions[1,2:13])

summary(lm(rhombus_delta ~ as.factor(condition), data = relevant_df))

```




```{r histograms}

hist(relevant_df$post_correct)






fit <- factanal(relevant_df[1:12], 2, rotation="varimax")
summary(fit) # print variance accounted for 
loadings(fit) # pc loadings 
plot(fit,type="lines") # scree plot 
fit$scores # the principal components
biplot(fit)

```


```{r process_guesses}
# The idea of this block is to determine how people's guesses in the active learning condition influenced
# their performance.

d$Answer.guesses

# How to encode the guesses? The rows are more important than the columns. So maybe something that reads:
# "participant chose two squares and one rectangle"

relevant_df$guessed <- 

```




